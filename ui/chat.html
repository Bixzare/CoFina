<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Your AI Agent for financial Assistant</title>
  <!-- Professional fonts & clean icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <style>
    /* ===== RESET & PRO TOKENS ===== */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      /* Deep‚ÄëSeek inspired blues + crisp neutrals */
      --bg-base:        #f9fcff;         /* clean page background */
      --surface:        #ffffff;
      --surface-muted:  #f2f6fa;
      --border-light:   #e3eaf2;
      --border-focus:   #3b82f6;

      --primary:        #1e3a8a;          /* deep navy ‚Äì trust */
      --primary-light:  #2563eb;          /* vibrant blue ‚Äì actions */
      --primary-soft:   #dbeafe;          /* very light blue ‚Äì highlights */
      --primary-glow:   rgba(37,99,235,0.08);

      --text-main:      #13294b;           /* near‚Äëblack navy */
      --text-muted:     #4b587c;
      --text-light:     #7085aa;
      --text-inverse:   #ffffff;

      --accent-gold:    #c7a262;           /* subtle warmth for numbers */
      --accent-soft-gold: rgba(199,162,98,0.1);
      --success:        #0f7b6b;
      --success-bg:     #e0f2f1;
      --warning:        #b6561c;
      --warning-bg:     #fff1e0;

      --radius-card:    20px;
      --radius-bubble:  18px;
      --radius-pill:    40px;
      --shadow-card:    0 8px 28px -6px rgba(0,30,60,0.12), 0 2px 8px -4px rgba(0,20,40,0.04);
      --shadow-elevated: 0 18px 36px -10px rgba(0,35,70,0.18);
      --transition:     all 0.2s ease;
    }

    body, html {
      height: 100%;
      background: var(--bg-base);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      color: var(--text-main);
      font-size: 15px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== MAIN LAYOUT ‚Äì ELEGANT CENTERING ===== */
    .app {
      max-width: 1020px;
      height: 100vh;
      margin: 0 auto;
      padding: 0 24px;
      display: grid;
      grid-template-rows: auto 1fr auto;
      background: var(--bg-base);
    }

    /* ===== HEADER ‚Äì CLEAN, PROFESSIONAL ===== */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 0 16px;
      border-bottom: 1px solid var(--border-light);
    }

    .logo-group {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-mark {
      width: 42px; height: 42px;
      background: linear-gradient(145deg, #ffffff 0%, #f0f7ff 100%);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(0,70,150,0.08);
      border: 1px solid rgba(37,99,235,0.15);
    }

    .logo-mark svg {
      width: 24px; height: 24px;
      stroke: var(--primary);
      stroke-width: 1.8;
    }

    .logo-text h1 {
      font-weight: 600;
      font-size: 1.7rem;
      letter-spacing: -0.02em;
      color: var(--primary);
      line-height: 1.2;
    }

    .logo-text span {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-light);
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }

    /* status bar ‚Äì minimal & informative */
    .status-panel {
      display: flex;
      align-items: center;
      gap: 14px;
      background: var(--surface);
      padding: 8px 16px 8px 12px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--border-light);
      box-shadow: 0 2px 6px rgba(0,0,0,0.02);
    }

    .status-dot {
      width: 10px; height: 10px;
      border-radius: 50%;
      background: #a0b8d0;
      transition: background 0.2s;
    }
    .status-dot.online { background: #0f7b6b; box-shadow: 0 0 0 2px #dff3f0; }
    .status-dot.thinking { background: var(--primary-light); animation: pulse 1.2s infinite; }

    #statusText {
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
    }

    .user-pill {
      display: flex;
      align-items: center;
      gap: 5px;
      background: var(--primary-soft);
      border-radius: 30px;
      padding: 4px 12px 4px 8px;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--primary);
      border: 1px solid rgba(37,99,235,0.2);
    }
    .user-pill svg { fill: var(--primary); width: 12px; height: 12px; }

    /* ===== MESSAGES CONTAINER ===== */
    .messages {
      overflow-y: auto;
      padding: 28px 4px 20px 4px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      scroll-behavior: smooth;
    }
    .messages::-webkit-scrollbar { width: 5px; }
    .messages::-webkit-scrollbar-track { background: transparent; }
    .messages::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 8px; }

    /* message row */
    .msg-row {
      display: flex;
      gap: 14px;
      align-items: flex-start;
      animation: messageSlide 0.3s cubic-bezier(0.15,1,0.3,1);
    }
    .msg-row.user { flex-direction: row-reverse; }

    /* avatars ‚Äì refined */
    .avatar {
      width: 42px; height: 42px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      box-shadow: 0 3px 10px rgba(0,0,0,0.02);
    }
    .avatar-agent {
      background: white;
      border: 1px solid #dce8f5;
      color: var(--primary);
    }
    .avatar-user {
      background: var(--primary);
      color: white;
    }
    .avatar svg { width: 22px; height: 22px; }

    /* bubble container */
    .bubble-wrapper {
      display: flex;
      flex-direction: column;
      max-width: 68%;
    }
    .msg-row.user .bubble-wrapper { align-items: flex-end; }

    .bubble {
      padding: 16px 20px;
      border-radius: var(--radius-bubble);
      font-size: 0.95rem;
      line-height: 1.55;
      box-shadow: 0 2px 6px rgba(0,20,40,0.04);
    }
    .bubble-agent {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-top-left-radius: 6px;
      color: var(--text-main);
    }
    .bubble-user {
      background: var(--primary);
      color: white;
      border-top-right-radius: 6px;
    }

    .bubble-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      margin-bottom: 5px;
      opacity: 0.7;
    }
    .bubble-user .bubble-label { color: rgba(255,255,255,0.85); }

    .meta-time {
      font-size: 0.7rem;
      color: var(--text-light);
      margin-top: 5px;
      padding: 0 5px;
    }

    /* professional formatting inside bubbles */
    .bubble-agent .highlight {
      background: var(--accent-soft-gold);
      border-radius: 6px;
      padding: 2px 8px;
      font-weight: 500;
      color: #8b6f3f;
      border: 1px solid rgba(199,162,98,0.25);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
    }
    .bubble-agent strong { color: var(--primary); font-weight: 600; }
    .bubble-agent .alert-line {
      padding: 10px 14px;
      border-radius: 12px;
      margin: 8px 0;
      font-size: 0.9rem;
    }
    .alert-warn { background: var(--warning-bg); border-left: 4px solid var(--warning); }
    .alert-ok { background: var(--success-bg); border-left: 4px solid var(--success); }
    .alert-info { background: #e8f0fe; border-left: 4px solid var(--primary-light); }

    /* ===== WELCOME CARD (PROFESSIONAL DASH) ===== */
    .welcome-card {
      background: var(--surface);
      border-radius: var(--radius-card);
      padding: 32px 36px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-card);
      margin-bottom: 8px;
      transition: var(--transition);
    }
    .welcome-card h2 {
      font-size: 1.9rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      color: var(--primary);
      margin-bottom: 8px;
    }
    .welcome-card h2 em {
      font-style: normal;
      color: var(--text-muted);
      font-weight: 400;
    }
    .welcome-card p {
      font-size: 1rem;
      color: var(--text-muted);
      max-width: 80%;
      margin-bottom: 28px;
    }
    .quick-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .quick-btn {
      background: var(--bg-base);
      border: 1px solid var(--border-light);
      border-radius: 40px;
      padding: 10px 20px;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
      box-shadow: 0 1px 3px rgba(0,0,0,0.02);
    }
    .quick-btn:hover {
      background: var(--surface);
      border-color: var(--primary-light);
      color: var(--primary);
      box-shadow: 0 6px 14px rgba(37,99,235,0.1);
      transform: translateY(-2px);
    }

    /* ===== THINKING INDICATOR ‚Äì POLISHED ===== */
    .thinking-row {
      display: flex;
      gap: 14px;
      align-items: flex-start;
      animation: fadeIn 0.3s;
    }
    .thinking-bubble {
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 24px;
      border-top-left-radius: 6px;
      padding: 18px 24px;
      min-width: 200px;
      box-shadow: var(--shadow-card);
    }
    .thinking-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--primary-light);
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    .thinking-content {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .ring-spinner {
      width: 22px; height: 22px;
      border: 2.5px solid var(--border-light);
      border-top-color: var(--primary-light);
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
    }
    .thinking-text {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-muted);
    }
    .dots-processing {
      display: flex;
      gap: 6px;
      margin-top: 12px;
    }
    .dots-processing span {
      width: 8px; height: 8px;
      background: var(--primary-light);
      border-radius: 50%;
      opacity: 0.5;
      animation: bounce 1.4s infinite;
    }
    .dots-processing span:nth-child(2) { animation-delay: 0.2s; }
    .dots-processing span:nth-child(3) { animation-delay: 0.4s; }

    /* ===== INPUT AREA ‚Äì ELEVATED ===== */
    .input-area {
      padding: 16px 0 24px;
      border-top: 1px solid var(--border-light);
    }
    .input-container {
      background: white;
      border: 1px solid var(--border-light);
      border-radius: 32px;
      padding: 8px 8px 8px 24px;
      display: flex;
      align-items: flex-end;
      gap: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.02);
      transition: border 0.15s, box-shadow 0.15s;
    }
    .input-container:focus-within {
      border-color: var(--primary-light);
      box-shadow: 0 0 0 4px var(--primary-glow);
    }
    textarea {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-main);
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      line-height: 1.5;
      resize: none;
      max-height: 130px;
      padding: 10px 0;
    }
    textarea::placeholder { color: var(--text-light); font-weight: 300; }
    .send-btn {
      width: 48px; height: 48px;
      background: var(--primary);
      border: none;
      border-radius: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s;
      box-shadow: 0 6px 16px rgba(30,58,138,0.2);
      flex-shrink: 0;
    }
    .send-btn:hover { background: var(--primary-light); transform: scale(1.05); }
    .send-btn:disabled { opacity: 0.3; pointer-events: none; }
    .send-btn svg { width: 20px; height: 20px; stroke: white; stroke-width: 2; fill: white; }

    .input-hint {
      text-align: center;
      font-size: 0.75rem;
      color: var(--text-light);
      margin-top: 10px;
    }
    .input-hint kbd {
      background: var(--surface-muted);
      border-radius: 8px;
      padding: 3px 8px;
      font-family: 'Inter', monospace;
      border: 1px solid var(--border-light);
    }

    /* ===== ANIMATIONS ===== */
    @keyframes messageSlide {
      0% { opacity: 0; transform: translateY(12px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%,100% { opacity: 1; background: var(--primary-light); }
      50% { opacity: 0.5; background: #6b9cf0; }
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes bounce {
      0%,80%,100% { transform: translateY(0); opacity: 0.4; }
      40% { transform: translateY(-8px); opacity: 1; }
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>
<div class="app">

  <!-- HEADER (crisp) -->
  <header>
    <div class="logo-group">
      <div class="logo-mark">
        <svg viewBox="0 0 24 24" fill="none">
          <path d="M12 2L20 7V17L12 22L4 17V7L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
          <circle cx="12" cy="12" r="2.5" stroke="currentColor" stroke-width="1.5"/>
          <path d="M12 8V6M12 18V16M8 10.5L6 9M18 15L16 13.5M8 13.5L6 15M18 9L16 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="logo-text">
        <h1>CoFina</h1>
        <span>ü§ñ CoFina ¬∑ AI Agent for financial Assistant </span>
      </div>
    </div>
    <div class="status-panel">
      <div class="status-dot" id="statusDot"></div>
      <span id="statusText">connected</span>
      <span style="color:var(--border-light);">|</span>
      <div class="user-pill" id="userPill">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4.4 3.6-8 8-8s8 3.6 8 8"/></svg>
        <span id="userLabel">guest</span>
      </div>
    </div>
  </header>

  <!-- MESSAGES panel -->
  <div class="messages" id="messages">
    <div class="welcome-card" id="welcomeCard">
      <h2>Your journey to <em>financial freedom</em> starts now.</h2>
      <p>CoFina helps young professionals eliminate debt, invest wisely, and build lasting wealth. I adapt to your goals.</p>
      <div class="quick-actions">
        <button class="quick-btn" onclick="send('I want to sign up')">üìã Create profile</button>
        <button class="quick-btn" onclick="send('I want a debt payoff plan')">üìâ Debt plan</button>
        <button class="quick-btn" onclick="send('How should I start investing?')">üìà Investment 101</button>
        <button class="quick-btn" onclick="send('Help me budget for a home')">üè° Home budget</button>
      </div>
    </div>
  </div>

  <!-- INPUT -->
  <div class="input-area">
    <div class="input-container">
      <textarea id="input" placeholder="Ask about debt, investing, budgeting..." rows="1" autofocus></textarea>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Send (Enter)">
        <svg viewBox="0 0 24 24"><polygon points="22 2 15 22 11 13 2 9 22 2" /></svg>
      </button>
    </div>
    <div class="input-hint">
      <kbd>Enter</kbd> send ¬∑ <kbd>Shift+Enter</kbd> new line
    </div>
  </div>
</div>

<!-- SVG symbols (clean) -->
<svg style="display:none">
  <symbol id="icon-agent" viewBox="0 0 24 24">
    <path d="M12 2L20 7V17L12 22L4 17V7L12 2Z" fill="none" stroke="currentColor" stroke-width="1.8"/>
    <circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.8"/>
  </symbol>
  <symbol id="icon-user" viewBox="0 0 24 24">
    <circle cx="12" cy="8" r="4" fill="none" stroke="currentColor" stroke-width="1.8"/>
    <path d="M4 20c0-4.4 3.6-8 8-8s8 3.6 8 8" fill="none" stroke="currentColor" stroke-width="1.8"/>
  </symbol>
</svg>

<script>
  (function() {
    // ----- DOM refs -----
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const userLabel = document.getElementById('userLabel');
    const userPill = document.getElementById('userPill');

    let thinking = false;
    let currentUserId = 'guest';

    // ----- auto-resize -----
    inputEl.addEventListener('input', () => {
      inputEl.style.height = 'auto';
      inputEl.style.height = Math.min(inputEl.scrollHeight, 130) + 'px';
    });

    // ----- enter to send -----
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // ----- update UI status & user -----
    function setStatus(mode, text) {
      statusDot.className = 'status-dot';
      if (mode === 'online') statusDot.classList.add('online');
      else if (mode === 'thinking') statusDot.classList.add('thinking');
      statusText.textContent = text;
    }

    function updateUser(uid) {
      currentUserId = uid || 'guest';
      userLabel.textContent = currentUserId;
      if (currentUserId !== 'guest') {
        userPill.style.background = '#dbeafe';
        userPill.style.color = '#1e3a8a';
      } else {
        userPill.style.background = '#f2f6fa';
        userPill.style.color = '#4b587c';
      }
    }

    // ----- helper: format message with professional highlights -----
    function formatText(raw) {
      let s = raw.replace(/[&<>]/g, c => ({ '&':'&amp;', '<':'&lt;', '>':'&gt;' })[c]);

      // monetary & percent highlights
      s = s.replace(/\$[\d,]+(?:\.\d{2})?/g, m => `<span class="highlight">${m}</span>`);
      s = s.replace(/(\d+(?:\.\d+)?%)/g, m => `<span class="highlight">${m}</span>`);
      s = s.replace(/\b([a-f0-9]{8})\b/g, m => `<span class="highlight">${m}</span>`);

      // alert lines with icons
      s = s.replace(/(üî¥[^\n]+)/g, '<div class="alert-line alert-warn">$1</div>');
      s = s.replace(/(üü°[^\n]+)/g, '<div class="alert-line alert-warn">$1</div>');
      s = s.replace(/(‚úÖ[^\n]+)/g, '<div class="alert-line alert-ok">$1</div>');
      s = s.replace(/(‚ÑπÔ∏è[^\n]+)/g, '<div class="alert-line alert-info">$1</div>');
      s = s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');

      const paras = s.split(/\n\n+/).filter(p => p.trim());
      if (paras.length > 1) return paras.map(p => `<p>${p.replace(/\n/g,'<br>')}</p>`).join('');
      return `<p>${s.replace(/\n/g,'<br>')}</p>`;
    }

    // ----- append message bubble (agent/user) -----
    function appendMessage(role, text) {
      const row = document.createElement('div');
      row.className = `msg-row ${role}`;

      const avatar = document.createElement('div');
      avatar.className = `avatar avatar-${role}`;
      avatar.innerHTML = `<svg><use href="#icon-${role}"/></svg>`;

      const wrapper = document.createElement('div');
      wrapper.className = 'bubble-wrapper';

      const bubble = document.createElement('div');
      bubble.className = `bubble bubble-${role}`;

      const label = document.createElement('div');
      label.className = 'bubble-label';
      label.textContent = role === 'agent' ? 'CoFina' : 'You';
      bubble.appendChild(label);

      const content = document.createElement('div');
      content.innerHTML = formatText(text);
      bubble.appendChild(content);

      const meta = document.createElement('div');
      meta.className = 'meta-time';
      meta.textContent = new Date().toLocaleTimeString([], { hour:'2-digit', minute:'2-digit' });

      wrapper.appendChild(bubble);
      wrapper.appendChild(meta);

      if (role === 'user') {
        row.appendChild(wrapper);
        row.appendChild(avatar);
      } else {
        row.appendChild(avatar);
        row.appendChild(wrapper);
      }

      messagesEl.appendChild(row);
      scrollBottom();
    }

    // ----- thinking indicator (clean animation) -----
    function showThinking() {
      const id = 'think-' + Date.now();
      const row = document.createElement('div');
      row.className = 'thinking-row';
      row.id = id;

      const avatar = document.createElement('div');
      avatar.className = 'avatar avatar-agent';
      avatar.innerHTML = `<svg><use href="#icon-agent"/></svg>`;

      const bubble = document.createElement('div');
      bubble.className = 'thinking-bubble';
      bubble.innerHTML = `
        <div class="thinking-label">CoFina ¬∑ analyzing</div>
        <div class="thinking-content">
          <div class="ring-spinner"></div>
          <span class="thinking-text" id="thinkText-${id}">Gathering context</span>
        </div>
        <div class="dots-processing"><span></span><span></span><span></span></div>
      `;

      row.appendChild(avatar);
      row.appendChild(bubble);
      messagesEl.appendChild(row);
      scrollBottom();

      const states = ['Analyzing', 'Crunching numbers', 'Checking scenarios', 'Drafting insight'];
      let i = 0;
      const interval = setInterval(() => {
        const el = document.getElementById(`thinkText-${id}`);
        if (el) { i = (i+1) % states.length; el.textContent = states[i] + '‚Ä¶'; }
        else clearInterval(interval);
      }, 1500);
      row._interval = interval;
      return id;
    }

    function removeThinking(id) {
      const el = document.getElementById(id);
      if (el) {
        clearInterval(el._interval);
        el.style.opacity = '0';
        el.style.transition = '0.15s';
        setTimeout(() => el.remove(), 150);
      }
    }

    function scrollBottom() {
      requestAnimationFrame(() => messagesEl.scrollTop = messagesEl.scrollHeight);
    }

    // ----- quick send (from buttons) -----
    window.send = function(text) {
      inputEl.value = text;
      sendMessage();
    };

    // ----- core send message -----
    async function sendMessage() {
      const text = inputEl.value.trim();
      if (!text || thinking) return;

      const welcomeCard = document.getElementById('welcomeCard');
      if (welcomeCard) welcomeCard.style.display = 'none';

      appendMessage('user', text);
      inputEl.value = '';
      inputEl.style.height = 'auto';

      thinking = true;
      sendBtn.disabled = true;
      setStatus('thinking', 'CoFina is thinking');
      const thinkId = showThinking();

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text }),
        });
        const data = await res.json();
        removeThinking(thinkId);

        if (data.error) {
          appendMessage('agent', '‚ö†Ô∏è ' + data.error);
        } else {
          appendMessage('agent', data.response || data.message || 'üëç Done.');
          updateUser(data.user_id || currentUserId);
        }
        setStatus('online', 'Connected');
      } catch (err) {
        removeThinking(thinkId);
        appendMessage('agent', 'Unable to reach CoFina backend. Please ensure server is running.');
        setStatus('online', 'offline mode');
      }

      thinking = false;
      sendBtn.disabled = false;
      inputEl.focus();
    }

    // initial status check (mock, can be extended)
    async function checkStatus() {
      try {
        const r = await fetch('/status');
        const d = await r.json();
        setStatus('online', 'ready');
        updateUser(d.user_id);
      } catch {
        setStatus('online', 'demo mode');
        updateUser('guest');
      }
    }
    checkStatus();

    // expose sendMessage globally for button
    window.sendMessage = sendMessage;
  })();
</script>
</body>
</html>